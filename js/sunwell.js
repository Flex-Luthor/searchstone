!function(){"use strict";function e(e){c.settings.debug&&console.log(e)}function t(){return b.length?b.pop():document.createElement("canvas")}function r(e){b.push(e)}function a(r){if(e("Substitute for "+r),w)return w;var a=t(),i=a.getContext("2d");return a.width=a.height=512,i.save(),i.fillStyle="grey",i.fillRect(0,0,512,512),i.fill(),i.fillStyle="red",i.textAlign="center",i.textBaseline="middle",i.font="50px Belwe",i.fillText("missing artwork",256,256),i.restore(),w=new Image,w.src=a.toDataURL(),w}function i(e){return h[e]||a(e)}function s(e){var t,r,a="",i=305419896;for(r in e)a=a+r+e[r];for(t=0;t<a.length;t++)i+=a.charCodeAt(t)*(t+1);return i}function n(e,t,r,a,i){var s=.5522848,n=a/2*s,o=i/2*s,l=t+a,d=r+i,u=t+a/2,g=r+i/2;e.beginPath(),e.moveTo(t,g),e.bezierCurveTo(t,g-o,u-n,r,u,r),e.bezierCurveTo(u+n,r,l,g-o,l,g),e.bezierCurveTo(l,g+o,u+n,d,u,d),e.bezierCurveTo(u-n,d,t,g+o,t,g),e.stroke()}function o(t){return new Promise(function(r){for(var i,s,n,o,l,d=0,u=1,g={},w=0;w<t.length;w++)i=t[w],s=!1,n=!1,"h:"===i.substr(0,2)&&(s=!0,n=!!c.settings.smallTextureFolder,i=i.substr(2)),"t:"===i.substr(0,2)&&(s=!0,i=i.substr(2),void 0!==h[i]&&256===h[i].width&&(h[i]=void 0)),"u:"===i.substr(0,2)&&(o=!0,i=i.substr(2)),void 0===h[i]?(h[i]=new Image,h[i].crossOrigin="Anonymous",h[i].loaded=!1,u++,function(e){h[e].addEventListener("load",function(){d++,h[e].loaded=!0,g[e]=h[e],h[e].width&&h[e].height||(h[e].src=a().src),d>=u&&r(g)}),h[e].addEventListener("error",function(){d++,h[e].src=a().src,h[e].loaded=!0,g[e]=h[e],d>=u&&r(g)})}(i),o?h[i].src=i:(s?(h[i].isTexture=!0,l=n?c.settings.smallTextureFolder+i+".jpg":c.settings.textureFolder+i+".jpg"):l=c.settings.assetFolder+i+".png",e("Requesting "+l),h[i].src=l)):(u++,h[i].loaded?(d++,g[i]=h[i]):!function(e){h[e].addEventListener("load",function(){d++,g[e]=h[e],d>=u&&r(g)})}(i));u--,d>0&&d>=u&&r(g)})}function l(r,a,s,o,l,d){var u,g,c=s.sunwell,w=0,h=Date.now();g=setTimeout(function(){e("Drawing timeout at point "+w+" in "+s.title),e(s),d(),l&&l(r)},5e3),"string"==typeof s.texture?u=i(s.texture):s.texture instanceof Image?u=s.texture:(u=t(),u.width=s.texture.crop.w,u.height=s.texture.crop.h,function(){var e=u.getContext("2d");e.drawImage(s.texture.image,s.texture.crop.x,s.texture.crop.y,s.texture.crop.w,s.texture.crop.h,0,0,u.width,u.height)}()),u||(u=i("~")),w=2,a.save(),a.clearRect(0,0,r.width,r.height),w=3,a.save(),"MINION"===s.type&&(n(a,180*o,75*o,430*o,590*o),a.clip(),a.fillStyle="grey",a.fillRect(0,0,765*o,1100*o),a.drawImage(u,0,0,u.width,u.height,100*o,75*o,590*o,590*o)),"SPELL"===s.type&&(a.rect(125*o,165*o,529*o,434*o),a.clip(),a.fillStyle="grey",a.fillRect(0,0,765*o,1100*o),a.drawImage(u,0,0,u.width,u.height,125*o,117*o,529*o,529*o)),"WEAPON"===s.type&&(n(a,150*o,135*o,476*o,468*o),a.clip(),a.fillStyle="grey",a.fillRect(0,0,765*o,1100*o),a.drawImage(u,0,0,u.width,u.height,150*o,135*o,476*o,476*o)),a.restore(),w=4,a.drawImage(i(c.cardBack),0,0,764,1100,0,0,r.width,r.height),w=5,s.costHealth?(a.drawImage(i("health"),0,0,167,218,24*o,62*o,167*o,218*o),a.save(),a.shadowBlur=50*o,a.shadowColor="#FF7275",a.shadowOffsetX=1e3,a.globalAlpha=.5,a.drawImage(i("health"),0,0,167,218,24*o-1e3,62*o,167*o,218*o),a.restore()):a.drawImage(i("gem"),0,0,182,180,24*o,82*o,182*o,180*o),w=6,"MINION"===s.type&&(c.rarity&&a.drawImage(i(c.rarity),0,0,146,146,326*o,607*o,146*o,146*o),a.drawImage(i("title"),0,0,608,144,94*o,546*o,608*o,144*o),s.race&&a.drawImage(i("race"),0,0,529,106,125*o,937*o,529*o,106*o),a.drawImage(i("attack"),0,0,214,238,0,862*o,214*o,238*o),a.drawImage(i("health"),0,0,167,218,575*o,876*o,167*o,218*o),"LEGENDARY"===s.rarity&&a.drawImage(i("dragon"),0,0,569,417,196*o,0,569*o,417*o)),w=7,"SPELL"===s.type&&(c.rarity&&a.drawImage(i(c.rarity),0,0,149,149,311*o,607*o,150*o,150*o),a.drawImage(i("title-spell"),0,0,646,199,66*o,530*o,646*o,199*o)),"WEAPON"===s.type&&(c.rarity&&a.drawImage(i(c.rarity),0,0,146,144,315*o,592*o,146*o,144*o),a.drawImage(i("title-weapon"),0,0,660,140,56*o,551*o,660*o,140*o),a.drawImage(i("swords"),0,0,312,306,32*o,906*o,187*o,183*o),a.drawImage(i("shield"),0,0,301,333,584*o,890*o,186*o,205*o)),w=8,"CORE"!==s.set&&!function(){var e;"SPELL"===s.type&&(e=265),"MINION"===s.type&&(e=265),s.race&&"MINION"===s.type?a.drawImage(i(c.bgLogo),0,0,281,244,e*o,734*o,266.95*o,244*.95*o):"SPELL"===s.type?a.drawImage(i(c.bgLogo),0,0,281,244,e*o,740*o,253*o,220*o):a.drawImage(i(c.bgLogo),0,0,281,244,e*o,734*o,281*o,244*o)}(),w=9,w=10,w=11,w=12,a.restore(),clearTimeout(g),e("Rendertime: "+(Date.now()-h)+"ms"),d(),l&&l(r)}function d(e,t,r,a){f.push([e,t,a,r]),m||u()}function u(){y&&(g(),window.requestAnimationFrame(u))}function g(){if(!(m>p)){var a,i,s,n;if(f.length){var d=f.shift();m++,a=d[0],i=d[1],s=d[2],n=d[3],e("Preparing assets for: "+a.title);var u=t(),g=u.getContext("2d"),c=(i||512)/764,w=[];u.width=i||512,u.height=Math.round(1.4397905759*u.width),a.sunwell=a.sunwell||{},a.sunwell.cardBack=a.type.substr(0,1).toLowerCase()+a.playerClass.substr(0,1)+a.playerClass.substr(1).toLowerCase(),w.push(a.sunwell.cardBack),w.push("gem"),"MINION"===a.type&&(w.push("attack","health","title"),"LEGENDARY"===a.rarity&&w.push("dragon"),"FREE"===a.rarity||"COMMON"===a.rarity&&"CORE"===a.set||(a.sunwell.rarity="rarity-"+a.rarity.toLowerCase(),w.push(a.sunwell.rarity))),"SPELL"===a.type&&(w.push("attack","health","title-spell"),"FREE"===a.rarity||"COMMON"===a.rarity&&"CORE"===a.set||(a.sunwell.rarity="spell-rarity-"+a.rarity.toLowerCase(),w.push(a.sunwell.rarity))),"WEAPON"===a.type&&(w.push("swords","shield","title-weapon"),"FREE"===a.rarity||"COMMON"===a.rarity&&"CORE"===a.set||(a.sunwell.rarity="weapon-rarity-"+a.rarity.toLowerCase(),w.push(a.sunwell.rarity))),["BRM","GVG","LOE","NAXX","TGT","OG"].indexOf(a.set)===-1?a.sunwell.bgLogo="bg-cl":("NAXX"===a.set&&(a.set="NAX"),a.sunwell.bgLogo="bg-"+a.set.toLowerCase()),"SPELL"===a.type&&(a.sunwell.bgLogo="spell-"+a.sunwell.bgLogo),w.push(a.sunwell.bgLogo),a.race&&w.push("race"),"string"==typeof a.texture&&"CHEAT"!==a.set&&(c<=.5?w.push("h:"+a.texture):w.push("t:"+a.texture)),e("Assets prepared, now loading"),o(w).then(function(){e("Assets loaded for: "+a.title),l(u,g,a,c,s,function(){m--,e("Card rendered: "+a.title);var t;document.createEvent?(t=document.createEvent("HTMLEvents"),t.initEvent("dataavailable",!0,!0)):(t=document.createEventObject(),t.eventType="dataavailable"),t.eventName="dataavailable",document.createEvent?n.dispatchEvent(t):n.fireEvent("on"+t.eventType,t),r(u)})})}}}var c,w,h={},y=!1,f=[],p=12,m=0,v={},b=[],I=["COMMON","RARE","EPIC","LEGENDARY"];window.sunwell=c=window.sunwell||{},c._buffers=b,c._renderQuery=f,c._activeRenders=m,c.settings=c.settings||{},c.settings.titleFont=c.settings.titleFont||"Belwe Bold",c.settings.bodyFont=c.settings.bodyFont||"ITC Franklin Condensed",c.settings.bodyFontSize=c.settings.bodyFontSize||60,c.settings.bodyFontOffset=c.settings.bodyFontOffset||{x:0,y:0},c.settings.bodyLineHeight=c.settings.bodyLineHeight||50,c.settings.assetFolder=c.settings.assetFolder||"/assets/",c.settings.textureFolder=c.settings.textureFolder||"/artwork/",c.settings.smallTextureFolder=c.settings.smallTextureFolder||null,c.settings.autoInit=c.settings.autoInit||!0,c.settings.idAsTexture=c.settings.idAsTexture||!1,c.settings.debug=c.settings.debug||!1,c.init=function(){y=!0,f.length&&u()},c.settings.autoInit||c.init(),c.clearCache=function(){v={}},c.createCard=function(t,r,a){if(!t)throw new Error("No card object given");a||(a=new Image),I.indexOf(t.rarity)===-1&&(t.rarity="FREE"),void 0===t.title&&(t.title=t.name),void 0===t.gameId&&(t.gameId=t.id),c.settings.idAsTexture&&(t.texture=t.gameId),t.costStyle=t.costStyle||"0",t.healthStyle=t.healthStyle||"0",t.attackStyle=t.attackStyle||"0",t.durabilityStyle=t.durabilityStyle||"0",t.costHealth=t.costHealth||!1,t.width=r;var i=s(t);return v[i]&&!c.settings.debug?void(a.src=v[i]):(e("Queried render: "+t.title),d(t,r,a,function(e){a.src=v[i]=e.toDataURL()}),{target:a,redraw:function(){i=s(t),delete v[i],d(t,r,a,function(e){a.src=v[i]=e.toDataURL()})},update:function(e){for(var n in e)t[n]=e[n];return i=s(t),v[i]?void(a.src=v[i]):void d(t,r,a,function(e){a.src=v[i]=e.toDataURL()})}})}}();