!function(){"use strict";function e(e){c.settings.debug&&console.log(e)}function t(){return b.length?b.pop():document.createElement("canvas")}function r(e){b.push(e)}function a(r){if(e("Substitute for "+r),h)return h;var a=t(),i=a.getContext("2d");return a.width=a.height=512,i.save(),i.fillStyle="grey",i.fillRect(0,0,512,512),i.fill(),i.fillStyle="red",i.textAlign="center",i.textBaseline="middle",i.font="50px Belwe",i.fillText("missing artwork",256,256),i.restore(),h=new Image,h.src=a.toDataURL(),h}function i(e){return w[e]||a(e)}function s(e){var t,r,a="",i=305419896;for(r in e)a=a+r+e[r];for(t=0;t<a.length;t++)i+=a.charCodeAt(t)*(t+1);return i}function n(e,t,r,a,i){var s=.5522848,n=a/2*s,o=i/2*s,l=t+a,u=r+i,d=t+a/2,g=r+i/2;e.beginPath(),e.moveTo(t,g),e.bezierCurveTo(t,g-o,d-n,r,d,r),e.bezierCurveTo(d+n,r,l,g-o,l,g),e.bezierCurveTo(l,g+o,d+n,u,d,u),e.bezierCurveTo(d-n,u,t,g+o,t,g),e.stroke()}function o(t){return new Promise(function(r){for(var i,s,n,o,l,u=0,d=1,g={},h=0;h<t.length;h++)i=t[h],s=!1,n=!1,"h:"===i.substr(0,2)&&(s=!0,n=!!c.settings.smallTextureFolder,i=i.substr(2)),"t:"===i.substr(0,2)&&(s=!0,i=i.substr(2),void 0!==w[i]&&256===w[i].width&&(w[i]=void 0)),"u:"===i.substr(0,2)&&(o=!0,i=i.substr(2)),void 0===w[i]?(w[i]=new Image,w[i].crossOrigin="Anonymous",w[i].loaded=!1,d++,function(e){w[e].addEventListener("load",function(){u++,w[e].loaded=!0,g[e]=w[e],w[e].width&&w[e].height||(w[e].src=a().src),u>=d&&r(g)}),w[e].addEventListener("error",function(){u++,w[e].src=a().src,w[e].loaded=!0,g[e]=w[e],u>=d&&r(g)})}(i),o?w[i].src=i:(s?(w[i].isTexture=!0,l=n?c.settings.smallTextureFolder+i+".jpg":c.settings.textureFolder+i+".jpg"):l=c.settings.assetFolder+i+".png",e("Requesting "+l),w[i].src=l)):(d++,w[i].loaded?(u++,g[i]=w[i]):!function(e){w[e].addEventListener("load",function(){u++,g[e]=w[e],u>=d&&r(g)})}(i));d--,u>0&&u>=d&&r(g)})}function l(r,a,s,o,l,u){var d,g,c=s.sunwell,h=0,w=Date.now();g=setTimeout(function(){e("Drawing timeout at point "+h+" in "+s.title),e(s),u(),l&&l(r)},5e3),"string"==typeof s.texture?d=i(s.texture):s.texture instanceof Image?d=s.texture:(d=t(),d.width=s.texture.crop.w,d.height=s.texture.crop.h,function(){var e=d.getContext("2d");e.drawImage(s.texture.image,s.texture.crop.x,s.texture.crop.y,s.texture.crop.w,s.texture.crop.h,0,0,d.width,d.height)}()),d||(d=i("~")),h=2,a.save(),a.clearRect(0,0,r.width,r.height),h=3,a.save(),"MINION"===s.type&&(n(a,180*o,75*o,430*o,590*o),a.clip(),a.fillStyle="grey",a.fillRect(0,0,765*o,1100*o),a.drawImage(d,0,0,d.width,d.height,100*o,75*o,590*o,590*o)),"SPELL"===s.type&&(a.rect(125*o,165*o,529*o,434*o),a.clip(),a.fillStyle="grey",a.fillRect(0,0,765*o,1100*o),a.drawImage(d,0,0,d.width,d.height,125*o,117*o,529*o,529*o)),"WEAPON"===s.type&&(n(a,150*o,135*o,476*o,468*o),a.clip(),a.fillStyle="grey",a.fillRect(0,0,765*o,1100*o),a.drawImage(d,0,0,d.width,d.height,150*o,135*o,476*o,476*o)),a.restore(),h=4,a.drawImage(i(c.cardBack),0,0,764,1100,0,0,r.width,r.height),h=5,s.multiClassGroup&&"MINION"===s.type&&a.drawImage(i(c.multiBanner),-15,0,184,369,17*o,88*o,184*o,369*o),s.costHealth?(a.drawImage(i("health"),0,0,167,218,24*o,62*o,167*o,218*o),a.save(),a.shadowBlur=50*o,a.shadowColor="#FF7275",a.shadowOffsetX=1e3,a.globalAlpha=.5,a.drawImage(i("health"),0,0,167,218,24*o-1e3,62*o,167*o,218*o),a.restore()):a.drawImage(i("gem"),0,0,182,180,24*o,82*o,182*o,180*o),h=6,"MINION"===s.type&&(c.rarity&&a.drawImage(i(c.rarity),0,0,146,146,326*o,607*o,146*o,146*o),a.drawImage(i("title"),0,0,608,144,94*o,546*o,608*o,144*o),s.race&&a.drawImage(i("race"),0,0,529,106,125*o,937*o,529*o,106*o),a.drawImage(i("attack"),0,0,214,238,0,862*o,214*o,238*o),a.drawImage(i("health"),0,0,167,218,575*o,876*o,167*o,218*o),"LEGENDARY"===s.rarity&&a.drawImage(i("dragon"),0,0,569,417,196*o,0,569*o,417*o)),h=7,"SPELL"===s.type&&(c.rarity&&a.drawImage(i(c.rarity),0,0,149,149,311*o,607*o,150*o,150*o),a.drawImage(i("title-spell"),0,0,646,199,66*o,530*o,646*o,199*o)),"WEAPON"===s.type&&(c.rarity&&a.drawImage(i(c.rarity),0,0,146,144,315*o,592*o,146*o,144*o),a.drawImage(i("title-weapon"),0,0,660,140,56*o,551*o,660*o,140*o),a.drawImage(i("swords"),0,0,312,306,32*o,906*o,187*o,183*o),a.drawImage(i("shield"),0,0,301,333,584*o,890*o,186*o,205*o)),h=8,"CORE"!==s.set&&!function(){a.globalCompositeOperation="color-burn","MINION"===s.type?s.race?a.drawImage(i(c.bgLogo),0,0,128,128,270*o,723*o,256*o,256*o):a.drawImage(i(c.bgLogo),0,0,128,128,270*o,735*o,256*o,256*o):"SPELL"===s.type?(a.globalAlpha=.7,a.drawImage(i(c.bgLogo),0,0,128,128,264*o,726*o,256*o,256*o)):"WEAPON"===s.type&&(a.globalCompositeOperation="lighten",a.globalAlpha=.07,a.drawImage(i(c.bgLogo),0,0,128,128,264*o,735*o,256*o,256*o)),a.globalCompositeOperation="source-over",a.globalAlpha=1}(),h=12,a.restore(),clearTimeout(g),e("Rendertime: "+(Date.now()-w)+"ms"),u(),l&&l(r)}function u(e,t,r,a){p.push([e,t,a,r]),m||d()}function d(){y&&(g(),window.requestAnimationFrame(d))}function g(){if(!(m>f)){var a,i,s,n;if(p.length){var u=p.shift();m++,a=u[0],i=u[1],s=u[2],n=u[3],e("Preparing assets for: "+a.title);var d=t(),g=d.getContext("2d"),c=(i||512)/764,h=[];d.width=i||512,d.height=Math.round(1.4397905759*d.width),a.sunwell=a.sunwell||{},a.sunwell.cardBack=a.type.substr(0,1).toLowerCase()+a.playerClass.substr(0,1)+a.playerClass.substr(1).toLowerCase(),h.push(a.sunwell.cardBack),h.push("gem"),"MINION"===a.type&&(h.push("attack","health","title"),"LEGENDARY"===a.rarity&&h.push("dragon"),"FREE"===a.rarity||"COMMON"===a.rarity&&"CORE"===a.set||(a.sunwell.rarity="rarity-"+a.rarity.toLowerCase(),h.push(a.sunwell.rarity))),"SPELL"===a.type&&(h.push("attack","health","title-spell"),"FREE"===a.rarity||"COMMON"===a.rarity&&"CORE"===a.set||(a.sunwell.rarity="spell-rarity-"+a.rarity.toLowerCase(),h.push(a.sunwell.rarity))),"WEAPON"===a.type&&(h.push("swords","shield","title-weapon"),"FREE"===a.rarity||"COMMON"===a.rarity&&"CORE"===a.set||(a.sunwell.rarity="weapon-rarity-"+a.rarity.toLowerCase(),h.push(a.sunwell.rarity))),-1===["BRM","GVG","KARA","LOE","NAXX","TGT","OG","GANGS"].indexOf(a.set)?a.sunwell.bgLogo="set-classic":a.sunwell.bgLogo="set-"+a.set.toLowerCase(),h.push(a.sunwell.bgLogo),a.race&&h.push("race"),-1!==["GRIMY_GOONS","JADE_LOTUS","KABAL"].indexOf(a.multiClassGroup)&&(a.sunwell.multiBanner="multi-"+a.multiClassGroup.toLowerCase(),h.push(a.sunwell.multiBanner)),"string"==typeof a.texture&&"CHEAT"!==a.set&&(.5>=c?h.push("h:"+a.texture):h.push("t:"+a.texture)),e("Assets prepared, now loading"),o(h).then(function(){e("Assets loaded for: "+a.title),l(d,g,a,c,s,function(){m--,e("Card rendered: "+a.title);var t;document.createEvent?(t=document.createEvent("HTMLEvents"),t.initEvent("dataavailable",!0,!0)):(t=document.createEventObject(),t.eventType="dataavailable"),t.eventName="dataavailable",document.createEvent?n.dispatchEvent(t):n.fireEvent("on"+t.eventType,t),r(d)})})}}}var c,h,w={},y=!1,p=[],f=12,m=0,v={},b=[],I=["COMMON","RARE","EPIC","LEGENDARY"];window.sunwell=c=window.sunwell||{},c._buffers=b,c._renderQuery=p,c._activeRenders=m,c.settings=c.settings||{},c.settings.titleFont=c.settings.titleFont||"Belwe Bold",c.settings.bodyFont=c.settings.bodyFont||"ITC Franklin Condensed",c.settings.bodyFontSize=c.settings.bodyFontSize||60,c.settings.bodyFontOffset=c.settings.bodyFontOffset||{x:0,y:0},c.settings.bodyLineHeight=c.settings.bodyLineHeight||50,c.settings.assetFolder=c.settings.assetFolder||"/assets/",c.settings.textureFolder=c.settings.textureFolder||"/artwork/",c.settings.smallTextureFolder=c.settings.smallTextureFolder||null,c.settings.autoInit=c.settings.autoInit||!0,c.settings.idAsTexture=c.settings.idAsTexture||!1,c.settings.debug=c.settings.debug||!1,c.init=function(){y=!0,p.length&&d()},c.settings.autoInit||c.init(),c.clearCache=function(){v={}},c.createCard=function(t,r,a){if(!t)throw new Error("No card object given");a||(a=new Image),-1===I.indexOf(t.rarity)&&(t.rarity="FREE"),void 0===t.title&&(t.title=t.name),void 0===t.gameId&&(t.gameId=t.id),c.settings.idAsTexture&&(t.texture=t.gameId),t.costStyle=t.costStyle||"0",t.healthStyle=t.healthStyle||"0",t.attackStyle=t.attackStyle||"0",t.durabilityStyle=t.durabilityStyle||"0",t.costHealth=t.costHealth||!1,t.width=r;var i=s(t);return v[i]&&!c.settings.debug?void(a.src=v[i]):(e("Queried render: "+t.title),u(t,r,a,function(e){a.src=v[i]=e.toDataURL()}),{target:a,redraw:function(){i=s(t),delete v[i],u(t,r,a,function(e){a.src=v[i]=e.toDataURL()})},update:function(e){for(var n in e)t[n]=e[n];return i=s(t),v[i]?void(a.src=v[i]):void u(t,r,a,function(e){a.src=v[i]=e.toDataURL()})}})}}();